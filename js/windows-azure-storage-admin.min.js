!function(a,b,c){"use strict";a(document).ready(function(){function c(d,e){a.post(b.ajaxurl,{action:"get-azure-progress",data:{item_id:d}}).done(function(f){var g=azureStorageConfig.l10n.uploadingToAzure+"...";f.data.total>0&&f.data.current>-1&&(g+=" ("+f.data.current+" / "+f.data.total+")"),f.data.progress>=0&&(a(".percent",e).html(g),a(".bar",e).width(2*f.data.progress),a("div.media-modal-content").find("div.media-uploader-status.uploading > *").first().text(g),a("div.media-modal-content").find("div.media-uploader-status.uploading").find("div.media-progress-bar > div").css("width",f.data.progress+"%"),a("div.media-modal-content").find("ul.attachments").find("div.media-progress-bar:last > div").css("width",f.data.progress+"%"),a("div.media-frame").find("ul.attachments").find("div.media-progress-bar:last > div").css("width",f.data.progress+"%"),a("div.media-frame-content").find("div.attachment-media-view.landscape").find("div.media-progress-bar > div").css("width",f.data.progress+"%"),a("div.media-modal.wp-core-ui").find("div.media-frame-title > h1").text(g)),f.data.progress<100&&b.setTimeout(function(){c(d,e)},1e3)}).fail(function(){b.setTimeout(function(){c(d,e)},1e3)})}if(a("#windows-azure-storage-media-button").on("click",function(b){b.preventDefault();var c=a(b.currentTarget),d=c.data("editor")+"-azure",e={frame:"post",state:"iframe:browse",title:wp.media.view.l10n.addMedia,multiple:!1};c.blur(),wp.azureFrame=wp.media.editor.open(d,e),wp.azureFrame.on("azure:selected",function(a){var b='<img src="'+a.url+'" />';a.isImage||(b='<a href="'+a.url+'">'+a.url+"</a>"),wp.media.editor.activeEditor="content",wp.media.editor.insert(b),wp.azureFrame.close()}),wp.azureFrame.on("close",function(){wp.azureFrame.off("azure:selected"),wp.media.editor.activeEditor="content"})}),a(".azure-container-selector").on("change",function(a){a.preventDefault();var b=document.getElementById("azure-settings-form"),c=document.getElementById("div-create-container");"__newContainer__"===b.elements.default_azure_storage_account_container_name.value?(c.style.display="block",b.elements["azure-submit-button"].disabled=!0):(c.style.display="none",b.elements["azure-submit-button"].disabled=!1)}),a(".azure-create-container-button").on("click",function(b){b.preventDefault();var c=document.getElementById("azure-settings-form"),d=document.getElementsByName("action")[0];"undefined"!=typeof d&&(d.name="action2"),c.action=a(this).data("containerUrl"),c.submit()}),b.before_upload=function(a,b){a.settings.multipart_params.item_id=b.id},b.upload_progess=function(d,e){if(100===e.percent){var f=a("#media-item-"+e.id);a(".percent",f).html(azureStorageConfig.l10n.uploadingToAzure),a("div.media-uploader-status.uploading > *").first().text(azureStorageConfig.l10n.uploadingToAzure),b.setTimeout(function(){c(e.id,f)},2e3)}},"undefined"!=typeof uploader&&(uploader.bind("UploadProgress",function(a,c){b.upload_progess(a,c)}),uploader.bind("BeforeUpload",function(a,c){b.before_upload(a,c)})),wp&&wp.media&&wp.media.view&&wp.media.view.UploaderWindow){var d=wp.media.view.UploaderWindow;wp.media.view.UploaderWindow=wp.media.view.UploaderWindow.extend({ready:function(){d.prototype.ready.apply(this,arguments),this.uploader.uploader.bind("BeforeUpload",function(a,c){b.before_upload(a,c)}),this.uploader.uploader.bind("UploadProgress",function(a,c){b.upload_progess(a,c)})}})}})}(jQuery,this);