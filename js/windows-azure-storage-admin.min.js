!function(o,r,e){"use strict";o(document).ready(function(){if(o("#windows-azure-storage-media-button").on("click",function(e){e.preventDefault();var a=o(e.currentTarget),t=a.data("editor")+"-azure",i={frame:"post",state:"iframe:browse",title:wp.media.view.l10n.addMedia,multiple:!1};a.blur(),wp.azureFrame=wp.media.editor.open(t,i),wp.azureFrame.on("azure:selected",function(e){var a='<img src="'+e.url+'" />';e.isImage||(a='<a href="'+e.url+'">'+e.url+"</a>"),wp.media.editor.activeEditor="content",wp.media.editor.insert(a),wp.azureFrame.close()}),wp.azureFrame.on("close",function(){wp.azureFrame.off("azure:selected"),wp.media.editor.activeEditor="content"})}),o(".azure-container-selector").on("change",function(e){e.preventDefault();var a=document.getElementById("azure-settings-form"),t=document.getElementById("div-create-container");"__newContainer__"===a.elements.default_azure_storage_account_container_name.value?(t.style.display="block",a.elements["azure-submit-button"].disabled=!0):(t.style.display="none",a.elements["azure-submit-button"].disabled=!1)}),o(".azure-create-container-button").on("click",function(e){e.preventDefault();var a=document.getElementById("azure-settings-form"),t=document.getElementsByName("action")[0];void 0!==t&&(t.name="action2"),a.action=o(this).data("containerUrl"),a.submit()}),r.before_upload=function(e,a){e.settings.multipart_params.item_id=a.id},r.upload_progess=function(e,a){if(100===a.percent){var t=o("#media-item-"+a.id);o(".percent",t).html(azureStorageConfig.l10n.uploadingToAzure),o("div.media-uploader-status.uploading > *").first().text(azureStorageConfig.l10n.uploadingToAzure),r.setTimeout(function(){!function t(i,d){o.post(r.ajaxurl,{action:"get-azure-progress",data:{item_id:i}}).done(function(e){var a=azureStorageConfig.l10n.uploadingToAzure+"...";0<e.data.total&&-1<e.data.current&&(a+=" ("+e.data.current+" / "+e.data.total+")"),0<=e.data.progress&&(o(".percent",d).html(a),o(".bar",d).width(2*e.data.progress),o("div.media-modal-content").find("div.media-uploader-status.uploading > *").first().text(a),o("div.media-modal-content").find("div.media-uploader-status.uploading").find("div.media-progress-bar > div").css("width",e.data.progress+"%"),o("div.media-modal-content").find("ul.attachments").find("div.media-progress-bar:last > div").css("width",e.data.progress+"%"),o("div.media-frame").find("ul.attachments").find("div.media-progress-bar:last > div").css("width",e.data.progress+"%"),o("div.media-frame-content").find("div.attachment-media-view.landscape").find("div.media-progress-bar > div").css("width",e.data.progress+"%"),o("div.media-modal.wp-core-ui").find("div.media-frame-title > h1").text(a)),e.data.progress<100&&r.setTimeout(function(){t(i,d)},1e3)}).fail(function(){r.setTimeout(function(){t(i,d)},1e3)})}(a.id,t)},2e3)}},"undefined"!=typeof uploader&&(uploader.bind("UploadProgress",function(e,a){r.upload_progess(e,a)}),uploader.bind("BeforeUpload",function(e,a){r.before_upload(e,a)})),wp&&wp.media&&wp.media.view&&wp.media.view.UploaderWindow){var e=wp.media.view.UploaderWindow;wp.media.view.UploaderWindow=wp.media.view.UploaderWindow.extend({ready:function(){e.prototype.ready.apply(this,arguments),this.uploader.uploader.bind("BeforeUpload",function(e,a){r.before_upload(e,a)}),this.uploader.uploader.bind("UploadProgress",function(e,a){r.upload_progess(e,a)})}})}})}(jQuery,this);