!function(e,a,t){"use strict";e(document).ready(function(){if(e("#windows-azure-storage-media-button").on("click",function(a){a.preventDefault();var t=e(a.currentTarget),i=t.data("editor")+"-azure",d={frame:"post",state:"iframe:browse",title:wp.media.view.l10n.addMedia,multiple:!1};t.blur(),wp.azureFrame=wp.media.editor.open(i,d),wp.azureFrame.on("azure:selected",function(e){var a='<img src="'+e.url+'" />';e.isImage||(a='<a href="'+e.url+'">'+e.url+"</a>"),wp.media.editor.activeEditor="content",wp.media.editor.insert(a),wp.azureFrame.close()}),wp.azureFrame.on("close",function(){wp.azureFrame.off("azure:selected"),wp.media.editor.activeEditor="content"})}),e(".azure-container-selector").on("change",function(e){e.preventDefault();var a=document.getElementById("azure-settings-form"),t=document.getElementById("div-create-container");"__newContainer__"===a.elements.default_azure_storage_account_container_name.value?(t.style.display="block",a.elements["azure-submit-button"].disabled=!0):(t.style.display="none",a.elements["azure-submit-button"].disabled=!1)}),e(".azure-create-container-button").on("click",function(a){a.preventDefault();var t=document.getElementById("azure-settings-form"),i=document.getElementsByName("action")[0];void 0!==i&&(i.name="action2"),t.action=e(this).data("containerUrl"),t.submit()}),a.before_upload=function(e,a){e.settings.multipart_params.item_id=a.id},a.upload_progess=function(t,i){if(100===i.percent){var d=e("#media-item-"+i.id);e(".percent",d).html(azureStorageConfig.l10n.uploadingToAzure),e("div.media-uploader-status.uploading > *").first().text(azureStorageConfig.l10n.uploadingToAzure),a.setTimeout(function(){!function t(i,d){e.post(a.ajaxurl,{action:"get-azure-progress",data:{item_id:i}}).done(function(o){var r=azureStorageConfig.l10n.uploadingToAzure+"...";o.data.total>0&&o.data.current>-1&&(r+=" ("+o.data.current+" / "+o.data.total+")"),o.data.progress>=0&&(e(".percent",d).html(r),e(".bar",d).width(2*o.data.progress),e("div.media-modal-content").find("div.media-uploader-status.uploading > *").first().text(r),e("div.media-modal-content").find("div.media-uploader-status.uploading").find("div.media-progress-bar > div").css("width",o.data.progress+"%"),e("div.media-modal-content").find("ul.attachments").find("div.media-progress-bar:last > div").css("width",o.data.progress+"%"),e("div.media-frame").find("ul.attachments").find("div.media-progress-bar:last > div").css("width",o.data.progress+"%"),e("div.media-frame-content").find("div.attachment-media-view.landscape").find("div.media-progress-bar > div").css("width",o.data.progress+"%"),e("div.media-modal.wp-core-ui").find("div.media-frame-title > h1").text(r)),o.data.progress<100&&a.setTimeout(function(){t(i,d)},1e3)}).fail(function(){a.setTimeout(function(){t(i,d)},1e3)})}(i.id,d)},2e3)}},"undefined"!=typeof uploader&&(uploader.bind("UploadProgress",function(e,t){a.upload_progess(e,t)}),uploader.bind("BeforeUpload",function(e,t){a.before_upload(e,t)})),wp&&wp.media&&wp.media.view&&wp.media.view.UploaderWindow){var t=wp.media.view.UploaderWindow;wp.media.view.UploaderWindow=wp.media.view.UploaderWindow.extend({ready:function(){t.prototype.ready.apply(this,arguments),this.uploader.uploader.bind("BeforeUpload",function(e,t){a.before_upload(e,t)}),this.uploader.uploader.bind("UploadProgress",function(e,t){a.upload_progess(e,t)})}})}})}(jQuery,this);